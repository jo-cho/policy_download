from selenium.webdriver.common.by import By
import time
from tqdm import tqdm
import pandas as pd
from selenium import webdriver
download_dir = "/Users/downloads/files_epic"

num_list = ['0000187508', '0000186841', '0000186250', '0000185938', '0000185437', '0000185029', '0000184780', '0000184765', '0000184726', '0000184680', '0000183876', '0000183751', '0000183667', '0000183624', '0000183215', '0000183214', '0000183090', '0000182984', '0000182895', '0000182694', '0000181941', '0000181883', '0000181315', '0000181018', '0000180959', '0000180938', '0000180933', '0000180569', '0000180516', '0000180478', '0000180058', '0000179832', '0000179778', '0000179418', '0000179104', '0000178901', '0000178576', '0000177148', '0000177025', '0000176831', '0000176642', '0000176554', '0000175617', '0000175308', '0000175239', '0000173119', '0000172782', '0000172016', '0000171320', '0000169645', '0000167911', '0000165713', '0000164698', '0000164656', '0000164445', '0000164360', '0000163524', '0000161282', '0000161010', '0000160970', '0000160861', '0000160745', '0000160652', '0000159336', '0000157469', '0000157289', '0000157287', '0000157067', '0000156217', '0000154959', '0000154599', '0000153981', '0000153967', '0000153311', '0000152920', '0000151875', '0000151104', '0000150961', '0000150356', '0000150293', '0000150180', '0000149708', '0000149470', '0000149312', '0000148602', '0000148434', '0000147690', '0000147689', '0000147365', '0000146856', '0000145481', '0000145460', '0000145354', '0000145170', '0000145117', '0000145008', '0000145005', '0000144956', '0000144920', '0000144856', '0000144522', '0000144470', '0000144453', '0000143508', '0000142666', '0000141530', '0000140367', '0000140245', '0000139781', '0000139464', '0000138915', '0000138570', '0000138531', '0000137661', '0000137596', '0000137100', '0000136755', '0000136650', '0000136171', '0000135715', '0000135697', '0000135440', '0000135287', '0000134803', '0000133937', '0000133534', '0000133505', '0000133116', '0000132934', '0000132933', '0000132908', '0000132545', '0000131877', '0000131165', '0000130782', '0000130530', '0000129927', '0000128536', '0000126366', '0000125587', '0000124482', '0000123836', '0000123779', '0000123451', '0000123089', '0000122422', '0000120783', '0000119707', '0000119210', '0000118630', '0000118512', '0000117815', '0000117667', '0000117266', '0000116640', '0000116339', '0000114643', '0000113202', '0000110231', '0000108610', '0000107800', '0000107262', '0000105596', '0000105204', '0000104593', '0000104203', '0000102811', '0000101948', '0000101413', '0000101379', '0000100258', '000099916', '000096840', '000096694', '000095431', '000095377', '000095285', '000093881', '000092464', '000088745', '000086697', '000085437', '000085270', '000081706', '000079698', '000078170', '000077841', '000075871', '000075381', '000074989', '000074047', '000073711', '000073120', '000071582', '000070008', '000069976', '000066303', '000065467', '000064874', '000063527', '000061793', '000061635', '000060351', '000057524', '000055850', '000054312', '000047949', '000044147', '000013315', '0000168889', '0000157101', '0000147498', '0000176169', '0000165651', '0000146791', '0000131898', '0000128664', '0000114943', '0000111648', '000068801', '000050962', '000044522', '000037683', '0000187505', '0000186121', '0000186037', '0000176789', '0000153369', '0000150274', '0000150262', '0000150232', '0000138514', '0000137696', '0000137671', '0000120523', '0000106207', '000084822', '000073462', '000063243', '000058014', '000057455', '000052856', '000040761', '000040654', '000039789', '000038774', '000034926', '000033592', '000030718', '0000187412', '0000185758', '0000185400', '0000182977', '0000182749', '0000178763', '0000168375', '0000161442', '0000148435', '0000123522', '0000120663', '0000184599', '0000180070', '0000179831', '0000178896', '0000173556', '0000173148', '0000169403', '0000168890', '0000162953', '0000160490', '0000154061', '0000136050', '0000110901', '000057790', '0000185522', '0000184331', '0000181376', '0000180958', '0000173526', '0000168296', '0000160374', '0000154273', '0000152507', '0000152141', '0000149472', '0000148777', '0000147415', '0000147383', '0000147203', '0000145442', '0000143230', '0000135891', '0000134574', '0000133556', '0000132129', '0000131041', '0000129648', '0000129255', '0000123564', '0000120372', '0000101696', '000090247', '000063888', '000063788', '000059144', '000054708', '000049533', '000040290', '000038345', '000023255', '0000187509', '0000187030', '0000185399', '0000184858', '0000183358', '0000183093', '0000182855', '0000182400', '0000182361', '0000180897', '0000175523', '0000175383', '0000174402', '0000172238', '0000172177', '0000171489', '0000169141', '0000168938', '0000164925', '0000162571', '0000161243', '0000160811', '0000158768', '0000158584', '0000158399', '0000158018', '0000155503', '0000155423', '0000154561', '0000153583', '0000153081', '0000151575', '0000150801', '0000150065', '0000149710', '0000148014', '0000146191', '0000146055', '0000145726', '0000145059', '0000143811', '0000141609', '0000139188', '0000135777', '0000135030', '0000133866', '0000130769', '0000121123', '0000119534', '000095562', '000059498', '000028761', '0000182898', '0000182853', '0000181680', '0000173301', '0000172753', '0000171004', '0000169140', '0000167297', '0000164160', '0000162741', '0000161443', '0000161441', '0000160980', '0000158645', '0000157801', '0000156786', '0000156651', '0000153271', '0000153023', '0000151820', '0000151765', '0000151407', '0000151261', '0000151152', '0000149994', '0000149679', '0000149439', '0000148636', '0000146613', '0000146547', '0000146478', '0000146206', '0000146142', '0000145871', '0000144253', '0000142434', '0000142120', '0000135050', '000058558', '000023259', '0000187320', '0000183173', '0000183021', '0000182608', '0000181342', '0000176613', '0000159994', '0000146121', '0000145650', '0000133222', '000043896', '000034665', '0000183257', '0000180648', '0000169390', '0000169142', '0000168927', '0000159141', '0000159028', '0000157594', '0000153513', '0000152939', '0000150329', '0000150242', '0000150236', '0000148959', '0000144013', '0000143120', '0000141259', '0000139214', '0000138822', '0000137760', '0000137368', '0000136909', '0000136616', '0000136561', '0000126449', '0000117384', '0000103360', '000087034', '000073341', '000066689', '000054712', '000054710', '000054602', '000054547', '000052070', '000051215', '000044510', '000044267', '000029218', '0000182987', '0000180647', '0000176678', '0000170936', '0000170720', '0000169641', '0000159917', '0000153388', '0000150635', '0000150085', '0000145780', '0000145581', '0000142013', '0000140429', '0000139646', '0000187631', '0000187553', '0000187355', '0000186429', '0000186343', '0000184457', '0000184365', '0000184099', '0000182731', '0000181852', '0000181796', '0000181594', '0000181304', '0000181264', '0000177890', '0000177567', '0000175922', '0000175877', '0000175838', '0000175791', '0000175409', '0000175303', '0000174400', '0000172442', '0000167777', '0000167450', '0000166840', '0000164832', '0000164416', '0000161986', '0000159029', '0000157468', '0000157148', '0000156990', '0000156945', '0000156756', '0000155502', '0000155443', '0000155278', '0000153821', '0000152400', '0000150521', '0000150087', '0000148301', '0000147181', '0000147067', '0000146527', '0000146042', '0000146039', '0000145341', '0000143702', '0000143305', '0000143273', '0000143228', '0000143217', '0000142958', '0000142894', '0000142789', '0000142729', '0000142586', '0000142166', '0000141715', '0000141281', '0000140912', '0000140098', '0000139045', '0000137753', '0000137726', '0000137228', '0000137056', '0000134972', '0000134712', '0000133984', '0000133869', '0000133118', '0000130924', '0000130703', '0000129989', '0000129756', '0000129601', '0000129254', '0000129125', '0000128993', '0000128539', '0000128136', '0000127652', '0000126542', '0000126245', '0000126034', '0000125812', '0000125223', '0000124814', '0000124667', '0000123379', '0000123366', '0000121764', '0000120199', '0000119828', '0000118665', '0000118456', '0000117482', '0000116911', '0000116661', '0000116315', '0000115166', '0000113872', '0000113706', '0000113022', '0000111434', '0000111138', '0000110190', '0000109174', '0000108676', '0000105739', '0000103437', '0000102612', '0000102393', '000099322', '000096856', '000095569', '000084821', '000080607', '000077988', '000077358', '000065663', '000063242', '000057526', '000057525', '000057523', '000057522', '000057521', '000056017', '000055195', '000055160', '000054714', '000054709', '000054707', '000054706', '000054705', '000054704', '000054703', '000054700', '000054699', '000054608', '000054607', '000054606', '000054605', '000054603', '000054601', '000054600', '000054598', '000054597', '000054594', '000054593', '000054592', '000054591', '000054590', '000052476', '000052283', '000052089', '000050339', '000050102', '000049534', '000049532', '000049528', '000049526', '000049525', '000048750', '000048728', '000048727', '000045642', '000044523', '000044521', '000044520', '000044519', '000044517', '000044516', '000044512', '000043908', '000043905', '000043904', '000043903', '000043901', '000043899', '000043898', '000039192', '000038355', '000038350', '000038045', '000037068', '000035896', '000035712', '000034652', '000034605', '000034604', '000032670', '000032358', '000031470', '000029213', '000027798', '000027796', '000027177', '000026893', '000024327', '000023272', '000023261', '000023258', '000023253', '000023252', '000023251', '000023249', '000023248', '000023241', '000023239', '000023236', '000023235', '000023232', '000023227', '000023225', '000023219', '000023218', '000023215', '000023211', '000023209', '000023201', '000023199', '000023195', '000023194', '000021787', '000017904', '000013840', '000013310', '000013303', '0000187628', '0000186205', '0000186202', '0000186200', '0000185260', '0000184893', '0000184550', '0000182978', '0000182693', '0000182322', '0000182000', '0000181906', '0000181595', '0000181316', '0000181261', '0000180942', '0000180932', '0000180397', '0000179963', '0000179379', '0000179048', '0000178727', '0000171417', '0000168635', '0000168497', '0000167694', '0000165473', '0000164018', '0000161811', '0000161136', '0000160971', '0000160731', '0000160217', '0000159843', '0000159228', '0000158769', '0000158763', '0000158509', '0000158224', '0000158017', '0000157731', '0000155634', '0000155621', '0000155618', '0000155279', '0000152012', '0000151312', '0000150954', '0000150326', '0000149946', '0000149915', '0000148977', '0000147823', '0000147478', '0000146740', '0000146597', '0000146531', '0000144674', '0000143794', '0000143688', '0000143108', '0000141529', '0000139795', '0000138918', '0000136662', '0000136366', '0000136152', '0000133090', '0000132167', '0000127148', '0000124562', '0000123512', '0000119663', '0000117895', '0000117678', '0000114067', '0000109396', '000097643', '000095643', '000095571', '000088743', '000042620', '000040402', '000036020', '000023579', '000023561', '000020702', '0000187845', '0000187410', '0000187113', '0000187025', '0000186997', '0000186862', '0000186527', '0000186299', '0000185976', '0000185393', '0000185271', '0000185189', '0000184892', '0000184728', '0000184721', '0000184587', '0000184418', '0000184254', '0000184061', '0000183398', '0000183397', '0000182396', '0000181720', '0000181606', '0000180798', '0000180642', '0000180605', '0000180209', '0000180207', '0000179930', '0000179764', '0000179381', '0000176904', '0000176897', '0000176013', '0000175975', '0000175754', '0000174507', '0000173528', '0000171637', '0000171349', '0000171315', '0000171003', '0000169244', '0000168943', '0000168365', '0000167331', '0000167300', '0000163447', '0000162738', '0000162205', '0000161750', '0000161139', '0000161058', '0000160973', '0000160860', '0000160774', '0000160743', '0000160727', '0000160670', '0000160494', '0000160466', '0000160411', '0000160394', '0000160345', '0000160334', '0000159671', '0000159110', '0000157556', '0000156545', '0000155880', '0000155581', '0000153046', '0000152506', '0000150764', '0000150461', '0000150411', '0000150233', '0000150164', '0000150028', '0000149681', '0000149649', '0000149617', '0000148908', '0000148482', '0000148013', '0000147787', '0000146528', '0000146461', '0000146372', '0000145446', '0000145042', '0000144660', '0000143539', '0000142940', '0000141721', '0000141092', '0000140880', '0000140618', '0000140616', '0000140375', '0000139946', '0000139797', '0000138913', '0000138679', '0000138550', '0000138174', '0000137701', '0000136955', '0000136598', '0000136240', '0000136228', '0000136227', '0000136225', '0000136208', '0000136207', '0000136206', '0000136205', '0000136204', '0000136185', '0000136184', '0000135974', '0000135869', '0000135163', '0000135029', '0000134730', '0000134620', '0000134310', '0000134112', '0000133093', '0000132994', '0000132640', '0000132533', '0000132414', '0000130830', '0000130653', '0000130266', '0000130263', '0000129573', '0000129504', '0000129051', '0000128463', '0000127741', '0000126980', '0000126725', '0000126568', '0000126436', '0000126319', '0000126193', '0000126010', '0000125685', '0000125487', '0000125002', '0000124751', '0000124716', '0000124613', '0000124450', '0000124086', '0000123744', '0000123199', '0000123023', '0000122224', '0000121649', '0000121371', '0000121336', '0000120441', '0000119414', '0000118915', '0000118887', '0000118791', '0000118598', '0000118232', '0000118167', '0000118130', '0000118103', '0000117845', '0000117571', '0000116413', '0000116383', '0000116067', '0000115741', '0000115460', '0000115396', '0000115204', '0000114841', '0000114336', '0000113495', '0000112447', '0000112192', '0000111299', '0000111127', '0000110823', '0000109632', '0000108373', '0000108339', '0000108059', '0000107668', '0000107422', '0000105405', '0000105254', '0000104853', '0000101973', '0000100180', '0000100057', '000099944', '000099369', '000098976', '000098951', '000098006', '000095987', '000095379', '000095304', '000094421', '000090070', '000089427', '000089001', '000088140', '000086217', '000085955', '000085029', '000083183', '000083061', '000082242', '000081834', '000081559', '000079831', '000073015', '000073009', '000072966', '000072539', '000071617', '000070752', '000069407', '000067588', '000067536', '000067489', '000066839', '000065791', '000064791', '000063982', '000063784', '000063402', '000063239', '000063228', '000063220', '000062914', '000061781', '000060579', '000059692', '000059003', '000058792', '000057606', '000056643', '000055136', '000052868', '000052339', '000052286', '000052209', '000048583', '000048533', '000048505', '000048504', '000048503', '000048502', '000048501', '000046188', '000046041', '000045638', '000044148', '000043374', '000040783', '000038872', '000038816', '000036308', '000035049', '000033593', '000032995', '000032759', '000032757', '000031949', '000031907', '000031901', '000031469', '000031279', '000030719', '000030635', '000026962', '0000187622', '0000187453', '0000187446', '0000186876', '0000186574', '0000186570', '0000186535', '0000186534', '0000186427', '0000186305', '0000185951', '0000185728', '0000185602', '0000185233', '0000185039', '0000185037', '0000184974', '0000184727', '0000184722', '0000184635', '0000184286', '0000184203', '0000184201', '0000183831', '0000183663', '0000183549', '0000183130', '0000183055', '0000182643', '0000182590', '0000182558', '0000182323', '0000182002', '0000181999', '0000181950', '0000181945', '0000181649', '0000181395', '0000181389', '0000181267', '0000181149', '0000180894', '0000180743', '0000180108', '0000179986', '0000179973', '0000179380', '0000179049', '0000179029', '0000178801', '0000178799', '0000178071', '0000177743', '0000177695', '0000177234', '0000176123', '0000173722', '0000173360', '0000173010', '0000172638', '0000172635', '0000172550', '0000172549', '0000172355', '0000170680', '0000169964', '0000169584', '0000168374', '0000167415', '0000167409', '0000167132', '0000167026', '0000165633', '0000165573', '0000164908', '0000164766', '0000164652', '0000164500', '0000164497', '0000164489', '0000164399', '0000164394', '0000164381', '0000164374', '0000164364', '0000164337', '0000164060', '0000164049', '0000164031', '0000163960', '0000163902', '0000163824', '0000163568', '0000163474', '0000163152', '0000162596', '0000162535', '0000162533', '0000162133', '0000162090', '0000162008', '0000161796', '0000161322', '0000160952', '0000160879', '0000160873', '0000160807', '0000159844', '0000159058', '0000158360', '0000158089', '0000157883', '0000155701', '0000155631', '0000155157', '0000152059', '0000152014', '0000151536', '0000151015', '0000150424', '0000149990', '0000149552', '0000148825', '0000147051', '0000146775', '0000146391', '0000146283', '0000145688', '0000145633', '0000145496', '0000144542', '0000144136', '0000143933', '0000142226', '0000140713', '0000140710', '0000139563', '0000139549', '0000139382', '0000139245', '0000138982', '0000138682', '0000137734', '0000137583', '0000137375', '0000136979', '0000136884', '0000136862', '0000136861', '0000136853', '0000136786', '0000136568', '0000135698', '0000133431', '0000133429', '0000132882', '0000132660', '0000129231', '0000128216', '0000127330', '0000127247', '0000121661', '0000120614', '0000120413', '0000119508', '0000117003', '0000115805', '0000113092', '0000111693', '0000106971', '0000105993', '0000105877', '000099747', '000096174', '000090515', '000088387', '000079293', '000078633', '000076990', '000073104', '000064168', '000062337', '000053289', '000051755', '000046922', '000045248', '000042465', '000042315', '000035050', '000034770', '000028547', '000024987', '000021308', '000020645', '000018440', '000018437', '000018436']
print(num_list)

if __name__ == '__main__':
    # Chrome WebDriver 시작
    options = webdriver.ChromeOptions()
    options.add_experimental_option("prefs", {
        "download.default_directory": download_dir
    })
    driver = webdriver.Chrome(options=options)

    # 웹페이지로 이동
    driver.get(
        "https://eiec.kdi.re.kr/policy/materialList.do?depth1=J0000&depth2=J0900&code=J0601&code=J0602&code=J0603&code=J0801&code=J0802&code=J0901&search_txt=&topic=&pg=1&pp=4400&type=J&device=pc")
    time.sleep(5)
    df_list = []
    start_num2 = 3621
    end_num2 = 4314 #4346
    num_list = []

    # 일련번호만 찾자
    for n in tqdm(range(start_num2, end_num2+1)):
        # 제목, 부처 날짜 페이지 찾기
        url = driver.find_element(By.CSS_SELECTOR, f'#listArea > ul > li:nth-child({n}) > a').get_attribute('href')  # url
        url = url.split('&pg')[0]
        num = url.split('num=')[1]
        num_list.append(num)

    print(num_list)

    for n in tqdm(num_list):
        url = f"https://eiec.kdi.re.kr/policy/materialView.do?num={n}"
        driver.get(url)
        title = driver.find_element(By.CSS_SELECTOR,
                                    '#ui_contents > div.page_conts-bar.economy_multi > div.view_comm_style > div.view_top.downbtn_org > strong').text
        # 날짜 찾기
        date = driver.find_element(By.CSS_SELECTOR,
                                   '#ui_contents > div.page_conts-bar.economy_multi > div.view_comm_style > div.view_top.downbtn_org > div > div.downbtn_line > span:nth-child(1)').text
        page = driver.find_element(By.CSS_SELECTOR,
                                   '#ui_contents > div.page_conts-bar.economy_multi > div.view_comm_style > div.view_top.downbtn_org > div > div.downbtn_line > span:nth-child(2)').text

        # 부처 찾기
        dept = driver.find_element(By.CSS_SELECTOR,
                                    '#ui_contents > div.page_conts-bar.economy_multi > div.view_comm_style > div.view_top.downbtn_org > div > span').text
        dept = dept.split()[0]

        try:
            # 해당 항목이 존재하는 경우
            element = driver.find_element(By.CSS_SELECTOR,
                                          '#ui_contents > div.page_conts-bar.economy_multi > div.view_comm_style > div.view_top.downbtn_org > div > div.downbtn_line > div > div > ul > li > a')
            file_name = element.get_attribute('textContent')
            file_dn_link = element.get_attribute('href').split('&dtime')[0]
        except:
            # 항목이 없는 경우 None으로 처리
            file_name = None
            file_dn_link = None

        df0 = pd.DataFrame({"자료명": title, "발간일": date, "발간처": dept, "페이지수": page, "URL": url,
                            "파일명1": file_name, "파일명2": None, "파일명3": None, "파일명4": None,
                            "파일명5": None,
                            "다운로드링크1": file_dn_link, "다운로드링크2": None, "다운로드링크3": None,
                            "다운로드링크4": None,
                            "다운로드링크5": None}, index=[n])
        df_list.append(df0)

    df = pd.concat(df_list, axis=0)
    print(df)
    df.to_excel("C:/Users/master/downloads/metadata2.xlsx", engine='xlsxwriter')